var isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isTouch=!1,canSVG=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1");window.addEventListener("touchstart",function a(){isTouch=!0,window.removeEventListener("touchstart",a)},!1);var DreamPlayer=function(a){return this.settings=DreamPlayer.settings(a),this.settings?(this.elements=this.insert(),this.setEvents(),this.setPlayPause(),this.setProgressBar(),this.setSpinner(),this.setFullscreen(),this.setVolume(),this.setQualitys(),this.setControls(),this.elements.player.style.height=this.elements.player.offsetWidth/(16/9)+"px",window.addEventListener("resize",function(a){return function(){a.style.height=a.offsetWidth/(16/9)+"px"}}(this.elements.player),!1),void this.loadSources()):(console.error("Une erreur est survenu lors de la création du player."),!1)};DreamPlayer.prototype.toogleClass=function(a){(" "+this.elements.player.className+" ").search(" "+a+" ")>=0?this.removeClass(a):this.addClass(a)},DreamPlayer.prototype.addClass=function(a){(" "+this.elements.player.className+" ").search(" "+a+" ")<0&&(this.elements.player.className+=" "+a)},DreamPlayer.prototype.removeClass=function(a){for(;(" "+this.elements.player.className+" ").search(" "+a+" ")>=0;)this.elements.player.className=this.elements.player.className.replace(a,"")},DreamPlayer.addClass=function(a,b){(" "+a.className+" ").search(" "+b+" ")<0&&(a.className+=" "+b)},DreamPlayer.removeClass=function(a,b){for(;(" "+a.className+" ").search(" "+b+" ")>=0;)a.className=a.className.replace(b,"")},DreamPlayer.prototype.insert=function(){var a={},b=document.createElement("div");b.className="player",a.player=b;var c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("autobuffer",""),c.setAttribute("x-webkit-airplay","allow"),c.setAttribute("preload","auto"),c.setAttribute("poster",this.settings.poster),a.video=c;var d=document.createElement("source");d.type="video/mp4",a.srcMp4=d;var e=document.createElement("source");e.type="video/webm",a.srcWebm=e,c.appendChild(d),c.appendChild(e),b.appendChild(c);var f=document.createElement("div");f.className="controls",a.controls=f;var g=document.createElement("div");if(g.className="play-pause",canSVG&&!isFirefox){g.className="play-pause play-pause--svg";var h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("class","play-pause__svg"),h.setAttribute("viewBox","0 0 32 32"),h.setAttribute("fill","white"),h.setAttribute("stroke","white"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-width","8"),h.setAttribute("xmlns","http://www.w3.org/2000/svg");var i=document.createElementNS("http://www.w3.org/2000/svg","polygon");i.setAttribute("points","6,4 28,16 6,16 6,16"),h.appendChild(i),a.playPauseSVG1=i;var j=document.createElementNS("http://www.w3.org/2000/svg","polygon");j.setAttribute("points","6,16 28,16 6,28 6,28"),h.appendChild(j),a.playPauseSVG2=j,g.appendChild(h),a.playPauseSVG=g}a.playPause=g,b.appendChild(g);var k=document.createElement("div");k.className="qualitys",a.qualitys=k,b.appendChild(k);var l=document.createElement("div");l.className="icons";var m=document.createElement("div");m.className="icon icon--volume",a.volumeIcon=m;var n=document.createElement("div");n.className="icon icon--settings",a.settings=n;var o=document.createElement("div");o.className="icon icon--fullscreen",a.fullscreen=o,l.appendChild(o),l.appendChild(n),l.appendChild(m),b.appendChild(l);var p=document.createElement("div");p.className="volume-slide";var q=document.createElement("div");q.className="volume-slide__wrap",p.appendChild(q);var r=document.createElement("div");r.className="volume-slide__bar",r.style.width="0%";var s=document.createElement("div");s.className="volume-slide__dot",s.style.left="0%",q.appendChild(r),q.appendChild(s),a.volumeSlide=p,a.volumeSlide.bar=r,a.volumeSlide.dot=s,b.appendChild(p);var f=document.createElement("div");f.className="controls",a.controls=f;var t=document.createElement("div");t.className="controls__wrap",f.appendChild(t);var u=document.createElement("div");u.className="progress-bar";var v=document.createElement("div");v.className="progress-bar__wrap",u.appendChild(v);var w=document.createElement("div");w.className="progress-bar__viewed",w.style.width="0%";var x=document.createElement("div");x.className="progress-bar__current",x.style.left="0%";var y=document.createElementNS("http://www.w3.org/2000/svg","svg");y.setAttribute("class","progress-bar__spinner"),y.setAttribute("viewBox","0 0 32 32"),y.setAttribute("xmlns","http://www.w3.org/2000/svg");var z=document.createElementNS("http://www.w3.org/2000/svg","circle");z.setAttribute("fill","none"),z.setAttribute("stroke","white"),z.setAttribute("stroke-width","3"),z.setAttribute("stroke-linecap","round"),z.setAttribute("cx","16"),z.setAttribute("cy","16"),z.setAttribute("r","14"),y.appendChild(z);var A=document.createElement("div");return A.className="progress-bar__buffer",A.style.width="0%",v.appendChild(w),v.appendChild(x),v.appendChild(y),v.appendChild(A),a.progressBar=u,a.progressBar.viewed=w,a.progressBar.current=x,a.progressBar.spinner=y,a.progressBar.buffer=A,t.appendChild(u),b.appendChild(f),this.settings.cible.appendChild(b),a},DreamPlayer.getOffsets=function(a){for(var b=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement,c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop)&&a!==b;)c+=a.offsetLeft-a.scrollLeft,d+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:d,left:c}},DreamPlayer.prototype.addEvent=function(a,b,c){b="string"==typeof b?this.elements[b]:b;for(var d=0;d<this.events.length;d++)if(this.events[d].name.toLowerCase()==a.toLowerCase()){var e={events:[],callback:c,that:this,condition:this.events[d].condition};if(b){for(var f=0;f<this.events[d].events.length;f++)e.events.push(this.events[d].events[f]),b.addEventListener(this.events[d].events[f],this.onEvent,!1);b.eventsListeners||(b.eventsListeners=[]),b.eventsListeners.push(e)}}},DreamPlayer.prototype.onEvent=function(a){if(this.eventsListeners.length&&"undefined"!=typeof a)for(var b=0;b<this.eventsListeners.length;b++)for(var c=0;c<this.eventsListeners[b].events.length;c++)a.type==this.eventsListeners[b].events[c]&&(!this.eventsListeners[b].condition||this.eventsListeners[b].condition(a,this))&&this.eventsListeners[b].callback(a,this.eventsListeners[b].that)},DreamPlayer.prototype.setEvents=function(){this.events=[];for(var a=0;a<DreamPlayer.events.length;a++){for(var b={name:DreamPlayer.events[a].name,events:[],condition:DreamPlayer.events[a].condition?DreamPlayer.events[a].condition:null},c=0;c<DreamPlayer.events[a].events.length;c++)b.events.push(DreamPlayer.events[a].events[c]);this.events.push(b)}if(this.settings.debug){eventsNames="";for(var a=0;a<this.events.length;a++)eventsNames+=(a>0&&a<this.events.length-1?", ":"")+(a==this.events.length-1?" et ":"")+this.events[a].name;console.info("events setted",'"'+eventsNames+'"',this.events,"- DreamPlayer.prototype.setEvents")}},DreamPlayer.events=[{name:"loadeddata",events:["loadeddata"]},{name:"click",events:["click"]},{name:"dblClick",events:["dblclick"]},{name:"mouseDown",events:["mousedown"]},{name:"mouseUp",events:["mouseup"]},{name:"mouseMove",events:["mousemove"]},{name:"mouseOver",events:["mouseover"]},{name:"mouseOut",events:["mouseout"]},{name:"touchstart",events:["touchstart"]},{name:"touchmove",events:["touchmove"]},{name:"keyDown",events:["keydown"]},{name:"canPlay",events:["canplay"]},{name:"play",events:["play"]},{name:"pause",events:["pause"]},{name:"timeUpdate",events:["timeupdate"]},{name:"loadedMetaData",events:["loadedmetadata"]},{name:"mouseWheelUp",events:["mousewheel","DOMMouseScroll"],condition:function(a){return a.wheelDelta>0||a.detail<0}},{name:"mouseWheelDown",events:["mousewheel","DOMMouseScroll"],condition:function(a){return a.wheelDelta<0||a.detail>0}},{name:"orientationChange",events:["orientationchange"]}],DreamPlayer.prototype.setControls=function(){this.lastMouseMove={x:-1,y:-1},this.showControls(),this.setTimeoutHideControls(),this.addEvent("mousemove","player",function(a,b){a.pageX!==b.lastMouseMove.x&&a.pageY!==b.lastMouseMove.y&&(b.lastMouseMove.x=a.pageX,b.lastMouseMove.y=a.pageY,setTimeout(function(a){return function(){a.showControls()}}(b),1))}),this.addEvent("click","video",function(a,b){isTouch&&(" "+b.elements.controls.className+" ").search(" show ")>=0&&setTimeout(function(a){return function(){a.hideControls()}}(b),2)})},DreamPlayer.prototype.setTimeoutHideControls=function(){this.timeoutHideControls&&clearTimeout(this.timeoutHideControls),this.timeoutHideControls=setTimeout(function(a){a&&a.hideControls&&a.hideControls()},2500,this)},DreamPlayer.prototype.showControls=function(){(" "+this.elements.controls.className+" ").search(" show ")<=0&&(this.elements.player.style.cursor="",this.elements.controls.className+=" show",this.elements.player.className+=" show-settings"),this.setTimeoutHideControls()},DreamPlayer.prototype.hideControls=function(){(" "+this.elements.controls.className+" ").search(" show ")>=0&&(setTimeout(function(a){return function(){(" "+a.controls.className+" ").search(" show ")<=0&&(a.player.style.cursor="none")}}(this.elements),1e3),this.elements.controls.className=(" "+this.elements.controls.className+" ").replace("show",""),this.elements.player.className=(" "+this.elements.player.className+" ").replace("show-settings",""),this.removeClass("show-volume"))},DreamPlayer.prototype.toggleFullscreen=function(){var a=this.elements.player;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.removeClass("fullscreen")):(a.requestFullScreen?a.requestFullScreen():a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.webkitRequestFullscreen?a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen(),(a.requestFullScreen||a.requestFullscreen||a.webkitRequestFullScreen||a.webkitRequestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen)&&this.addClass("fullscreen"))},DreamPlayer.prototype.fullscreenChange=function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?this.addClass("fullscreen"):this.removeClass("fullscreen")},DreamPlayer.prototype.setFullscreen=function(){this.addEvent("dblclick","video",function(a,b){b.toggleFullscreen()}),this.addEvent("click","fullscreen",function(a,b){b.toggleFullscreen()}),document.addEventListener("webkitfullscreenchange",function(a){return function(){a.fullscreenChange(a)}}(this),!1),document.addEventListener("mozfullscreenchange",function(a){return function(){a.fullscreenChange(a)}}(this),!1),document.addEventListener("fullscreenchange",function(a){return function(){a.fullscreenChange(a)}}(this),!1)},DreamPlayer.prototype.setPlayPause=function(){this.addEvent("click","video",function(a,b){isTouch||(b.showControls(),b.tooglePlayPause())}),this.addEvent("mouseDown","playPause",function(a,b){b.tooglePlayPause()}),this.addEvent("play","video",function(a,b){if(b.addClass("playing"),b.elements.playPauseSVG){b.elements.playPauseSVG1.innerHTML="",b.elements.playPauseSVG2.innerHTML="";var c=document.createElementNS("http://www.w3.org/2000/svg","animate");c.setAttribute("attributeType","XML"),c.setAttribute("attributeName","points"),c.setAttribute("from",b.elements.playPauseSVG1.getAttribute("points")),c.setAttribute("to","26,4 26,28 24,28 24,4"),c.setAttribute("begin","indefinite"),c.setAttribute("dur",".18s"),b.elements.playPauseSVG1.setAttribute("points","6,4 8,4 8,28 6,28");var d=document.createElementNS("http://www.w3.org/2000/svg","animate");d.setAttribute("attributeType","XML"),d.setAttribute("attributeName","points"),d.setAttribute("from",b.elements.playPauseSVG2.getAttribute("points")),d.setAttribute("to","6,4 8,4 8,28 6,28"),d.setAttribute("begin","indefinite"),d.setAttribute("dur",".18s"),b.elements.playPauseSVG2.setAttribute("points","24,4 26,4 26,28 24,28"),b.elements.playPauseSVG1.appendChild(c),b.elements.playPauseSVG2.appendChild(d),c.beginElement(),d.beginElement()}}),this.addEvent("pause","video",function(a,b){if(b.removeClass("playing"),b.elements.playPauseSVG){b.elements.playPauseSVG1.innerHTML="",b.elements.playPauseSVG2.innerHTML="";var c=document.createElementNS("http://www.w3.org/2000/svg","animate");c.setAttribute("attributeType","XML"),c.setAttribute("attributeName","points"),c.setAttribute("from",b.elements.playPauseSVG1.getAttribute("points")),c.setAttribute("to","6,4 28,16 6,16 6,16"),c.setAttribute("begin","indefinite"),c.setAttribute("dur",".18s"),b.elements.playPauseSVG1.setAttribute("points","6,4 28,16 6,16 6,16");var d=document.createElementNS("http://www.w3.org/2000/svg","animate");d.setAttribute("attributeType","XML"),d.setAttribute("attributeName","points"),d.setAttribute("from",b.elements.playPauseSVG2.getAttribute("points")),d.setAttribute("to","6,16 28,16 6,28 6,28"),d.setAttribute("begin","indefinite"),d.setAttribute("dur",".18s"),b.elements.playPauseSVG2.setAttribute("points","6,16 28,16 6,28 6,28"),b.elements.playPauseSVG1.appendChild(c),b.elements.playPauseSVG2.appendChild(d),c.beginElement(),d.beginElement()}})},DreamPlayer.prototype.play=function(){this.elements.video.play()},DreamPlayer.prototype.pause=function(){this.elements.video.pause()},DreamPlayer.prototype.tooglePlayPause=function(){this.elements.video.paused?this.play():this.pause()},DreamPlayer.prototype.bufferUpdate=function(){var a=this.elements.video;a.buffered&&a.buffered.length>0&&(this.elements.progressBar.buffer.style.width=a.buffered.end(a.buffered.length-1)/a.duration*100+"%")},DreamPlayer.prototype.timeTo=function(a){var b=this.elements.video;b.currentTime=a},DreamPlayer.prototype.changeTime=function(a){var b=a.touches?a.touches[0].pageX:a.pageX,c=this.elements.progressBar,d=c.offsetWidth,e=Math.max(Math.min(b-DreamPlayer.getOffsets(c).left,d),0),f=e/d*100,g=f/100*this.elements.video.duration;isNaN(g)||(this.elements.progressBar.viewed.style.width=f+"%",this.elements.progressBar.current.style.left=f+"%",this.elements.progressBar.spinner.style.left=f+"%",this.timeTo(g))},DreamPlayer.prototype.setProgressBar=function(){this.addEvent("timeupdate","video",function(a,b){var c=b.elements.video.currentTime/b.elements.video.duration*100;b.elements.progressBar.viewed.style.width=c+"%",b.elements.progressBar.current.style.left=c+"%",b.elements.progressBar.spinner.style.left=c+"%",b.bufferUpdate()}),this.addEvent("loadedmetadata","video",function(a,b){b.bufferUpdate()}),this.addEvent("mousedown","progressBar",function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&(b.progressBarClicking=!0,DreamPlayer.addClass(b.elements.progressBar,"progress-bar--clicking"),b.changeTime.call(b,a))}),this.addEvent("touchstart","progressBar",function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&(b.progressBarClicking=!0,DreamPlayer.addClass(b.elements.progressBar,"progress-bar--clicking"),b.changeTime.call(b,a))}),this.addEvent("mouseup",document.body,function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&b.progressBarClicking&&(b.progressBarClicking=!1,DreamPlayer.removeClass(b.elements.progressBar,"progress-bar--clicking"),b.changeTime.call(b,a))}),this.addEvent("mousemove","player",function(a,b){b.progressBarClicking&&b.changeTime.call(b,a)}),this.addEvent("touchmove","player",function(a,b){b.progressBarClicking&&b.changeTime.call(b,a)})},DreamPlayer.prototype.toggleQualitys=function(){(" "+this.elements.player.className+" ").search("show-qualitys")>-1?this.hideQualitys():this.showQualitys()},DreamPlayer.prototype.showQualitys=function(){this.elements.qualitys.style.display="block",this.addClass("show-qualitys")},DreamPlayer.prototype.hideQualitys=function(){this.removeClass("show-qualitys"),setTimeout(function(a,b){return function(){-1===(" "+a.className+" ").search("show-qualitys")&&(b.style.display="none")}}(this.elements.player,this.elements.qualitys),500)},DreamPlayer.prototype.setQualitys=function(){this.volume(this.settings.volume),this.addEvent("click","settings",function(a,b){b.toggleQualitys()});for(var a=0;a<this.settings.sources.length;a++){var b=document.createElement("div");b.className="quality",b.innerHTML=this.settings.sources[a].text,b.setAttribute("data-format",this.settings.sources[a].format),this.elements.qualitys.appendChild(b),this.elements["quality"+this.settings.sources[a].format]=b,this.addEvent("click","quality"+this.settings.sources[a].format,function(a){return function(b,c){c.hideQualitys(),c.setSource(a)}}(a))}this.addEvent("loadeddata","video",function(a,b){b.lastTime&&(b.elements.video.currentTime=b.lastTime,b.lastTime=null)})},DreamPlayer.prototype.setSpinner=function(){return isFirefox?(this.elements.progressBar.spinner.parentNode.removeChild(this.elements.progressBar.spinner),!1):(this.elements.progressBar.spinner.style.opacity=1,this.elements.video.addEventListener("waiting",function(a){return function(){a.elements.progressBar.spinner.style.opacity=1}}(this),!1),this.elements.video.addEventListener("seeking",function(a){return function(){a.elements.progressBar.spinner.style.opacity=1}}(this),!1),this.addEvent("play","video",function(a,b){b.elements.progressBar.spinner.style.opacity=0}),void this.elements.video.addEventListener("seeked",function(a){return function(){a.elements.progressBar.spinner.style.opacity=0}}(this),!1))},DreamPlayer.prototype.volume=function(a){if(!a)var a=1;this.elements.volumeSlide.bar.style.width=100*a+"%",this.elements.volumeSlide.dot.style.left=100*a+"%",a>1?a=1:0>a&&(a=0),this.elements.video.volume=a,.05>=a?this.addClass("muted"):this.removeClass("muted")},DreamPlayer.prototype.sendVolume=function(){_logged_&&marmottajax.put({url:_webroot_+"account/volume",options:{volume:this.elements.video.volume}})},DreamPlayer.prototype.changeVolume=function(a){var b=a.touches?a.touches[0].pageX:a.pageX,c=this.elements.volumeSlide,d=c.offsetWidth,e=Math.max(Math.min(b-DreamPlayer.getOffsets(c).left,d),0),f=e/d;isNaN(f)||(this.elements.volumeSlide.bar.style.width=100*f+"%",this.volume(f))},DreamPlayer.prototype.hideVolume=function(){this.hideVolumeTimeout&&clearTimeout(this.hideVolumeTimeout),this.hideVolumeTimeout=setTimeout(function(a){return function(){a.removeClass("show-volume")}}(this),3500)},DreamPlayer.prototype.setVolume=function(){this.volume(this.settings.volume),this.addEvent("click","volumeIcon",function(a,b){(" "+b.elements.player.className+" ").search(" show-volume ")>=0?(b.hideVolume(),b.removeClass("show-volume")):(clearTimeout(this.hideVolumeTimeout),b.addClass("show-volume"))}),this.addEvent("mouseOver","volumeIcon",function(a,b){clearTimeout(this.hideVolumeTimeout),b.addClass("show-volume")}),this.addEvent("mouseout","volumeIcon",function(a,b){b.hideVolume()}),this.addEvent("mouseover","volumeSlide",function(a,b){clearTimeout(this.hideVolumeTimeout),b.addClass("show-volume")}),this.addEvent("mousemove","volumeSlide",function(a,b){clearTimeout(this.hideVolumeTimeout),b.addClass("show-volume")}),this.addEvent("mousedown","volumeSlide",function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&(b.volumeSlideClicking=!0,DreamPlayer.addClass(b.elements.volumeSlide,"volume-slide--clicking"),b.changeVolume.call(b,a))}),this.addEvent("touchstart","volumeSlide",function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&(b.volumeSlideClicking=!0,DreamPlayer.addClass(b.elements.volumeSlide,"volume-slide--clicking"),b.changeVolume.call(b,a))}),this.addEvent("mouseup",document.body,function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&b.volumeSlideClicking&&(b.volumeSlideClicking=!1,DreamPlayer.removeClass(b.elements.volumeSlide,"volume-slide--clicking"),b.changeVolume.call(b,a),b.sendVolume())}),this.addEvent("mousemove","player",function(a,b){b.volumeSlideClicking&&b.changeVolume.call(b,a)}),this.addEvent("touchmove","player",function(a,b){b.volumeSlideClicking&&b.changeVolume.call(b,a)})},DreamPlayer.settings=function(a){if(!(a&&a.poster&&a.cible&&a.sources))return console.error("Erreur lors de la récupération des paramètres de la vidéo",a),!1;for(var b={debug:a.debug?a.debug:!1,source:"undefined"!=typeof a.source?a.source:1,volume:"undefined"!=typeof a.volume?a.volume:1,poster:a.poster,cible:a.cible,sources:[]},c=0;c<a.sources.length;c++){var d=a.sources[c];if(!(d.format&&d.mp4&&d.webm))return console.error("Erreur lors de la récupération des formats de la vidéo",d),!1;b.sources.push({format:d.format,text:d.text,mp4:d.mp4,webm:d.webm})}return b},DreamPlayer.prototype.loadSources=function(){var a=0;"undefined"!=typeof this.settings.source&&(a=this.settings.source),this.elements.srcMp4.src=this.settings.sources[a].mp4,this.elements.srcWebm.src=this.settings.sources[a].webm,this.settings.debug&&console.info("format",this.settings.sources[a].format),this.currentSource=a},DreamPlayer.prototype.setSource=function(a){a!==this.currentSource&&(this.lastTime=this.elements.video.currentTime,this.elements.srcMp4.src=this.settings.sources[a].mp4,this.elements.srcWebm.src=this.settings.sources[a].webm,this.elements.video.load(),this.currentSource=a,_logged_&&marmottajax.put({url:_webroot_+"account/definition",options:{definition:a}}))};