function $(a){"function"==typeof a&&Application.dom_load_event_listeners.push(a)}function isset(a){return"undefined"!=typeof a}function backgroundLoader(a){this.element=El(a),this.src=this.element.getAttribute("data-background"),this.element.style.backgroundImage="url("+this.src+")",this.imgLoader=new Image,this.imgLoader.src=this.src,El(this.imgLoader).on("load",function(a,b){b.removeClass("bg-loader"),b.addClass("bg-loader-transition"),b.addClass("bg-loaded"),setTimeout(function(a){return function(){a.removeClass("bg-loader-transition")}}(b),300)},this.element)}function postMessage(){marmottajax.post({url:"../../../posts",json:!0,options:{"post-message-submit":"lol",channel:El("#channel-social-message-submit").getAttribute("data-channel-id"),"post-content":El("#post-content").value}}).then(function(){return function(a){El("#channel-posts").addFirst(Co('<channel-post avatar="${avatar}" channel="${channel}" message="${message}"/>',{avatar:_my_avatar_,channel:_my_pseudo_,message:a.content}))}}(El("#channel-social-message-submit").getAttribute("data-channel-id"))),El("#post-content").value=""}function postComment(a,b,c,d){DEBUG(["postComment called",{vid:a,commentContent:b,fromChannel:c,parent:d}]),marmottajax.post({url:"../comments/",options:{commentSubmit:"lol","comment-content":b,"from-channel":c,"video-id":a,parent:d}}).then(function(a){return function(b){var c=JSON.parse(b);c.channelUrl=a,c.avatar=_my_avatar_,c.plusNumber=0,c.moinsNumber=0,c.date="À l'instant",El("#comments-best").addFirst(Co('<comment data="${data}"/>',{data:c}))}}(c)),El("#textarea-comment").value=""}function setExporterInputValue(){if(!document.getElementById("exporter-input"))return!1;var a=El("#exporter-input"),b=El("#exporter-quality"),c=El("#exporter-autoplay"),d=El("#exporter-time-checkbox"),e=El("#exporter-time-input"),f="//dreamvids.fr/embed/"+_VIDEO_ID_,g=b.options[b.value].innerHTML||"640x360",h=g.split("x");width=h[0],height=h[1];var i=c.checked||!1;i&&(f+="/autoplay");var j=d.checked||!1;if(j)for(var k=e.value,l=k.split(":").reverse(),m=0;m<l.length;m++)f+=l[m]+"/";a.value='<iframe width="'+width+'" height="'+height+'" src="'+f+'" allowfullscreen frameborder="0"></iframe>'}var Application={name:"MarmWork"};!function(win,doc){function on(element,event,callback,binding){if(!element.length)return"#document-fragment"===element.nodeName?void on(element.childNodes,event,callback,binding):("function"==typeof elAndCoEvents.list[event]?elAndCoEvents.list[event](element,function(){return function(event){"string"==typeof callback?eval(callback):callback(event,binding)}}(callback,binding)):isset(element.addEventListener)?element.addEventListener(event,function(){return function(a){callback(a,binding)}}(callback,binding),!1):element.attachEvent("on"+event,function(){return function(a){callback(a,binding)}}(callback,binding)),element);for(var i=0;i<element.length;i++)on(element[i],event,callback,binding)}function childNodeList(a){for(var b=[],c=0;c<a.childNodes.length;c++)if(b.push(a.childNodes[c]),a.childNodes[c].childNodes)for(var d=childNodeList(a.childNodes[c]),e=0;e<d.length;e++)b.push(d[e]);return b}function isset(a){return"undefined"!=typeof a}var window=win,document=doc,ELCO_MAX_COMPONENTS_GENERATED=2048,elAndCoEvents={list:{}};elAndCoEvents.add=function(a,b){elAndCoEvents.list[a]=b},elAndCoEvents.onClickEventsList=[],elAndCoEvents.add("CLICK",function(a,b){var c=new elAndCoEvents.onClickObject(a,b);elAndCoEvents.onClickEventsList.push(c)}),elAndCoEvents.onClickObject=function(a,b){this.callback=b,this.element=a,this.touchstart=function(a){return function(b){a.moved=!1,a.startX=b.touches[0].clientX,a.startY=b.touches[0].clientY}}(this),this.touchmove=function(a){return function(b){(Math.abs(b.touches[0].clientX-a.startX)>10||Math.abs(b.touches[0].clientY-a.startY)>10)&&(a.moved=!0)}}(this),this.touchend=function(a){return function(b){a.moved||a.callback(b)}}(this),on(this.element,"touchstart",this.touchstart),on(this.element,"touchmove",this.touchmove),on(this.element,"touchend",this.touchend),on(this.element,"touchcancel",this.touchend),on(this.element,"click",function(a,b){"ontouchstart"in window||b.callback(a)},this)};var El=Element=function(a,b){if(this!==window)var c=Element.create(a,b);else var c=Element.select(a,b);return c?(c.childs=c.childNodes,c.parent=c.parentNode,c.clone=c.cloneNode,c.add=function(a){return function(b){if("#document-fragment"===b.nodeName){for(var c=[],d=b.childNodes,e=d.length,f=0;e>f;f++)a.appendChild(d[0]),c.push(a.childNodes[a.childNodes.length-1]);return c}if(!b.length)return a.appendChild(b),El(b);for(var f=0;f<b.length;f++){for(var c=[],e=b.length,f=0;e>f;f++)a.appendChild(b[0]),c.push(a.childNodes[a.childNodes.length-1]);return c}}}(c),c.addFirst=function(a){return function(b){if("#document-fragment"===b.nodeName){for(var c=[],d=b.childNodes,e=d.length,f=0;e>f;f++)a.insertBefore(d[0],a.firstChild),c.push(a.childNodes[a.childNodes.length-1]);return c}if(!b.length)return a.insertBefore(b,a.firstChild),El(b);for(var f=0;f<b.length;f++){for(var c=[],e=b.length,f=0;e>f;f++)a.insertBefore(b[0],a.firstChild),c.push(a.childNodes[a.childNodes.length-1]);return c}}}(c),c.on=function(a){return function(b,c,d){on(a,b,c,d)}}(c),c.offset=function(a){return function(){for(var b={x:0,y:0};a;)b.x+=a.offsetLeft-(a==document.body?0:a.scrollLeft)+a.clientLeft,b.y+=a.offsetTop-(a==document.body?0:a.scrollTop)+a.clientTop,a=a.offsetParent;return b}}(c),c.hasClass=function(a){return function(b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1}}(c),c.addClass=function(a){return function(b){return El(a).hasClass(b)||(a.className+=" "+b),El(a)}}(c),c.removeClass=function(a){return function(b){return a.className=(" "+a.className+" ").replace(" "+b+" "," "),El(a)}}(c),c.toggleClass=function(a){return function(b){return El(a).hasClass(b)?El(a).removeClass(b):El(a).addClass(b),El(a)}}(c),c):void 0};Element.create=function(a,b){var c,d=/[-\w]+/.exec(a)[0];if(c=document.createElement(d),"object"==typeof b)for(attribute in b)b.hasOwnProperty(attribute)&&!c.getAttribute(attribute)&&c.setAttribute(attribute,b[attribute]);var e=a.replace(/#([a-z-_]+)/i,"").replace(/\w+/,"").split(".");if(e.length>1){c.className="";for(var f=1;f<e.length;f++)c.className+=" "+e[f]}var g=/([a-z-_]+)(#([a-z-_]+))/i.exec(a);return g&&(c.id=g[3]),c},Element.select=function(a){var b;return"string"!=typeof a?b=a:"#"==a[0]&&(b=document.getElementById(a.substring(1))),b};var Co=Component=function(a,b){if(this===window)return Co.generate(a,b);if(a.name&&(Co.components[a.name]=this,"object"==typeof a))for(variable in a)a.hasOwnProperty(variable)&&(isset(this[variable])||(this[variable]=a[variable]))};Co.components={},Component.attributesParser=function(a,b){for(var c={},d=0;d<a.length;d++)if(c[a[d].name]=a[d].value,"string"==typeof a[d].value&&"$"==a[d].value[0]&&b)for(parameter in b)a[d].value==="${"+parameter+"}"&&b.hasOwnProperty(parameter)&&(c[a[d].name]=b[parameter]);return c},Component.prototype.create=function(a){var b=this.render(a),c=childNodeList(b);if(isset(a._CHILDNODES_)&&a._CHILDNODES_.length){for(var d=!1,e=0;e<c.length;e++){var f=c[e];if("_inner_"===f.getAttribute("tag-name")){for(;a._CHILDNODES_.length;)f.parentNode.insertBefore(a._CHILDNODES_[0],f);f.parentNode.removeChild(f),d=!0;break}}if(!d)for(;a._CHILDNODES_.length;)b.appendChild(a._CHILDNODES_[0])}return isset(this.created)&&this.created(b),b},Component.generate=function(a,b){if("string"!=typeof a)return document.createElement("div");a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/<([-\w]*)( (.+?))?\/>/g,"<$1$2></$1>"),a=a.replace(/<([-\w]*)( (.+?))?>/g,'<div tag-name="$1"$2>').replace(/<\/(.+?)>/g,"</div>");var c=document.createElement("div");c.innerHTML=a;var d=!1,e=!1;for(componentsCreated=0;!d;){e=!1,ELCO_MAX_COMPONENTS_GENERATED&&componentsCreated>ELCO_MAX_COMPONENTS_GENERATED&&(console.error("el & co erreur 001\nUne boucle de création de components a été détectée.\nLa génération des components a alors été arrêtée."),d=!0);for(var f=childNodeList(c),g=0;g<f.length;g++){var h=f[g],i="";if(h.getAttribute&&(i=h.getAttribute("tag-name")||""),Co.components[i]){var j=Component.attributesParser(h.attributes,b);j._CHILDNODES_=h.childNodes;var k=Co.components[i].create(j);for(attribute in j)j.hasOwnProperty(attribute)&&null===k.getAttribute(attribute)&&"string"==typeof j[attribute]&&k.setAttribute(attribute,j[attribute]);k.removeAttribute("tag-name"),h.parentNode.insertBefore(k,h),h.parentNode.removeChild(h),e=!0,componentsCreated++;break}}e||(d=!0)}return c.childNodes},Component.inner=function(a){var b=document.createElement("div");return b.setAttribute("tag-name","_inner_"),a.appendChild(b),a},window.Co=window.Component,window.El=window.Element,window.ELCO_MAX_COMPONENTS_GENERATED=ELCO_MAX_COMPONENTS_GENERATED}(window,document);var marmottajax=function(a){return marmottajax.get(a)};marmottajax.normalize=function(a){return a?"string"==typeof a?{url:a}:a:null},marmottajax.json=function(a){return(a=marmottajax.normalize(a))?(a.json=!0,new marmottajax.request(a)):void 0},marmottajax.get=function(a){return new marmottajax.request(a)},marmottajax.post=function(a){return(a=marmottajax.normalize(a))?(a.method="POST",new marmottajax.request(a)):void 0},marmottajax.put=function(a){return(a=marmottajax.normalize(a))?(a.method="PUT",new marmottajax.request(a)):void 0},marmottajax.destroy=marmottajax.remove=marmottajax.delete_=function(a){return(a=marmottajax.normalize(a))?(a.method="DELETE",new marmottajax.request(a)):void 0},marmottajax.request=function(a){if(!a)return!1;if("string"==typeof a&&(a={url:a}),"POST"===a.method||"PUT"===a.method||"DELETE"===a.method){var b="?";for(var c in a.options)b+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}else{a.method="GET",a.url+=a.url.indexOf("?")<0?"?":"";for(var c in a.options)a.url+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}this.xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.xhr.options=a,this.xhr.callbacks={then:[],error:[]},this.then=function(a){return this.xhr.callbacks.then.push(a),this},this.error=function(a){return this.xhr.callbacks.error.push(a),this},this.xhr.call=function(a,b){for(var c=0;c<this.callbacks[a].length;c++)"function"==typeof this.callbacks[a][c]&&this.callbacks[a][c](b)},this.xhr.onreadystatechange=function(){if(4===this.readyState&&200==this.status){var a=this.responseText;if(this.options.json)try{a=JSON.parse(a)}catch(b){return this.call("error","invalid json"),!1}this.call("then",a)}else 4===this.readyState&&404==this.status?this.call("error","404"):4===this.readyState&&this.call("error","unknow")},this.xhr.open(a.method,a.url,!0),this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.send("undefined"!=typeof b?b:null)},Application.dom_load_event_listeners=[],Application.dom_content_loaded=!1,Application.on_dom_content_loaded=function(){if(!Application.dom_content_loaded){Application.dom_content_loaded=!0;for(var a=0;a<Application.dom_load_event_listeners.length;a++){var b=Application.dom_load_event_listeners[a];"function"==typeof b&&b()}}},El(document).on("DOMContentLoaded",Application.on_dom_content_loaded),El(window).on("load",Application.on_dom_content_loaded),window.onload=function(){Application.on_dom_content_loaded()},$(function(){for(var a=0;a<Application.scripts.length;a++){var b=!1,c=Application.scripts[a];if("*"!==c.pages&&"all"!==c.pages&&c.pages)for(var d=0;d<c.pages.length;d++)c.pages[d]===_currentpage_&&(b=!0);else b=!0;b&&c.call()}}),Application.scripts=[];var Script=function(a){this.pages=a.pages,this.to_call=a.call,Application.scripts.push(this)};Script.prototype.call=function(){this.to_call()},new Component({name:"btn",render:function(a){var b="raised"===a.type?"raised":"flat",c=a.color?".btn--"+a.color:"",d=a.outline?".btn--outline-"+a.outline:"",e=a.ripple?".btn--ripple-"+a.ripple:"",f=isset(a.disable)?".disabled":"",g=new Element("div.btn.btn--"+b+c+d+e+f);return f||(g.tabIndex=0),"function"==typeof a.click&&El(g).on("CLICK",a.click,g),a["no-ripple"]||El(g).add(Co('<ripple parent="${parent}"/>',{parent:g})),g}}),new Co({name:"card",render:function(a){var b=isset(a.type)?a.type:"video";if("video"===b){var c=new El("div.card.video"),d=c.add(new El("div.thumbnail"));d.style.backgroundImage="url("+a.thumbnail+")";var e=d.add(new El("div.time"));e.innerHTML=a.duration;var f=d.add(new El("a.overlay"));f.href="watch/"+a["vid-id"];var g=c.add(new El("div.description")),h=g.add(new El("a"));h.href="watch/"+a["vid-id"];var i=h.add(new El("h4"));i.innerHTML=a.title;var j=g.add(new El("div")),k=j.add(new El("div.view"));k.innerHTML=a.views;var l=j.add(new El("a.channel"));l.href="channel/"+a.channel,l.innerHTML=a["channel-name"]}else if("plus"==b){var c=new El("div.card.plus"),m=c.add(new El("a"));m.href="watch/"+a["vid-id"];var d=m.add(new El("div.thumbnail"));d.style.backgroundImage="url("+a.thumbnail+")";var n=m.add(new El("p")),o=n.add(new El("b"));o.innerHTML=a["channel-name"],n.innerHTML+=' a aimé votre vidéo "<b>'+a["vid-name"]+'</b>"';var p=c.add(new El("i"));p.innerHTML=a["relative-time"]}else if("comment"==b){var c=new El("div.card.comment"),m=c.add(new El("a"));m.href="watch/"+a["vid-id"];var n=m.add(new El("p")),o=n.add(new El("b"));o.innerHTML=a["channel-name"],n.innerHTML+=' a commenté votre vidéo "<b>'+a["vid-name"]+'</b>"';var q=m.add(new El("blockquote"));q.innerHTML=a.comment;var p=c.add(new El("i"));p.innerHTML=a["relative-time"]}else if("channel"==b){var c=new El("div.card.channel"),m=c.add(new El("a"));m.href="watch/"+a.channel;var r=m.add(new El("div.avatar"));r.style.backgroundImage="url("+a.avatar+")";var n=m.add(new El("p")),o=n.add(new El("b"));o.innerHTML=a["channel-name"],n.innerHTML+=" s'est abonné à votre chaîne \"<b>"+a["my-channel-name"]+'</b>"';var s=c.add(new El("span.subscribers"));s.innerHTML="<b>"+a.subscribers+"</b> Abonnés";var p=c.add(new El("i"));p.innerHTML=a["relative-time"]}return c.on("CLICK",a.click,c),c}}),new Co({name:"channel-post",render:function(a){var b=new Element("div.channel-post"),c=b.add(new Element("img"));c.src=a.avatar;var d=b.add(new Element("p")),e=d.add(new Element("span.channel-name"));e.innerHTML=a.channel,d.innerHTML+=" a posté un message :";var f=b.add(new Element("div.social-message"));return f.innerHTML=a.message,b}}),new Co({name:"comment",render:function(a){if(a.data){var b=a.data,c=new El("div.comment"),d=c.add(new El("div.comment-head")),e=d.add(new El("div.user")),f=e.add(new El("img"));f.src=_my_avatar_;var g=e.add(new El("a"));g.href="../channel/"+b.channelUrl,g.innerHTML=b.author;var h=d.add(new El("div.date")),i=h.add(new El("p"));i.innerHTML=b.date;var j=c.add(new El("div.comment-text")),k=j.add(new El("p"));k.innerHTML=b.comment;var l=c.add(new El("div.comment-notation")),m=l.add(new El("ul")),n=m.add(new El("li.plus")),o=m.add(new El("li.moins"));return n.id="plus-"+b.id,o.id="moins-"+b.id,n.on("CLICK",function(a,b){likeComment(b)},b.id),o.on("CLICK",function(a,b){dislikeComment(b)},b.id),n.innerHTML="+"+b.plusNumber,o.innerHTML="-"+b.moinsNumber,c}}}),new Component({name:"ripple",render:function(a){var b=new Element("div.ripple");if(a.parent){var c="ontouchstart"in window?"touchstart":"mousedown";El(a.parent).on(c,function(a,b){var c=b.ripple,d=b.parent;if(!El(d).hasClass("disabled")){var e=c.add(new El("div.ripple__circle.ripple__circle--animate")),f=El(d).offset(),g=a.changedTouches?a.changedTouches[0].pageX:a.pageX,h=a.changedTouches?a.changedTouches[0].pageY:a.pageY;e.style.left=g-f.x+"px",e.style.top=h-f.y+"px"}},{ripple:b,parent:a.parent})}return b}}),new Script({call:function(){var a=document.getElementsByClassName("bg-loader");if(a&&a.length)for(var b=0,c=a.length;c>b;b++)new backgroundLoader(a[b])}}),new Script({call:function(){}}),new Script({pages:["channel"],call:function(){El("#channel-social-message-submit").on("click",postMessage),El("#post-content").on("keydown",function(a){13===a.keyCode&&a.ctrlKey&&postMessage()})}}),new Script({pages:["watch"],call:function(){if(DEBUG(["comment Script called",'El("#post-comment-button") :',El("#post-comment-button").nodeName]),!El("#post-comment-button"))return!1;var a=El("#post-comment-button");a.on("CLICK",function(a,b){DEBUG(["postCommentButton clicked",a,b]),DEBUG(["postComment",postComment]),DEBUG([b.getAttribute("data-vid-id"),El("#textarea-comment").value,El("#channel-selector").value,El("#parent-comment").value]),postComment(b.getAttribute("data-vid-id"),El("#textarea-comment").value,El("#channel-selector").value,El("#parent-comment").value)},a)}}),new Script({pages:["watch"],call:function(){return El("#embed-video-icon")?(El("#embed-video-icon").on("CLICK",function(){var a=El("#video-info-description");a.hasClass("export")?a.removeClass("export"):(a.addClass("export"),El("#exporter-input").select())}),El("#exporter-quality").on("change",setExporterInputValue),El("#exporter-autoplay").on("change",setExporterInputValue),El("#exporter-time-checkbox").on("change",setExporterInputValue),El("#exporter-time-input").on("change",setExporterInputValue),void setExporterInputValue()):!1}}),new Script({pages:["default","watch"],call:function(){}}),new Script({pages:["watch"],call:function(){if(!El("#share-video-icon"))return!1;var a=El("#share-video-icon");a.on("CLICK",function(){var a=El("#share-video-block"),b=El("#video-info-description");a.toggleClass("show"),b.toggleClass("little")})}});